/*!
 * canVideo v0.1.0
 * Copyright 2016 Ineer
 * Licensed under MIT (https://github.com/ineer/canvideo/blob/master/LICENSE)
 */
(function(){var g=function(){var b=navigator.userAgent;return{gecko:-1<b.indexOf("Gecko")&&-1==b.indexOf("KHTML"),mobile:!!b.match(/AppleWebKit.*Mobile.*/),UC:-1<b.indexOf("UCBrowser")||-1<b.indexOf("UC"),QQ:-1<b.indexOf("QQBrowser")||-1<b.indexOf("QQ"),android:-1<b.indexOf("Android")||-1<b.indexOf("Linux"),iPhone:-1<b.indexOf("iPhone"),iPad:-1<b.indexOf("iPad")}}();if(g.android&&g.UC)return alert("\u7531\u4e8eUC\u52ab\u6301Video\u7684\u6076\u52a3\u884c\u4e3a,\u7528\u6237\u4f7f\u7528UC\u6d4f\u89c8\u7f51\u9875, canVideo\u5c06\u4e0d\u63d0\u4f9b\u89c6\u9891\u64ad\u653e\u529f\u80fd.\n\u4e3a\u6b64\u4e0d\u4fbf,\u6df1\u8868\u6b49\u610f.\n\u63a8\u8350\u4f7f\u7528Chrome\u6216Firefox\u8fdb\u884c\u6d4f\u89c8."),!1;if(g.android&&g.QQ)return alert("\u7531\u4e8eQQ\u6d4f\u89c8\u5668\u52ab\u6301Video\u7684\u6076\u52a3\u884c\u4e3a,\u7528\u6237\u4f7f\u7528QQ\u6d4f\u89c8\u5668\u6d4f\u89c8\u7f51\u9875, canVideo\u5c06\u4e0d\u63d0\u4f9b\u89c6\u9891\u64ad\u653e\u529f\u80fd.\n\u4e3a\u6b64\u4e0d\u4fbf,\u6df1\u8868\u6b49\u610f.\n\u63a8\u8350\u4f7f\u7528Chrome\u6216Firefox\u8fdb\u884c\u6d4f\u89c8."),!1;var f=document.querySelector("canvas[video]");if(f){var A=function(){!document.webkitIsFullScreen&&void 0!==document.webkitIsFullScreen||!document.mozFullScreen&&void 0!==document.mozFullScreen?z(f,c):setTimeout(A,125)},z=function(b,e){document.exitFullScreen?document.exitFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen&&document.mozCancelFullScreen();b.parentNode.style.width=a.cow+"px";b.parentNode.style.height=a.coh+"px";b.width=a.cow;b.height=a.coh;b.parentNode.style.transform="rotate(0deg)";a.rotate="0";u(b,e);b.parentNode.classList.remove("full-screen");a.isFullScreen=!1;h()},B=function(b){a.pow=p.offsetWidth;a.seek=c.buffered.end(0);b.width=100*a.seek/c.duration+"%";a.seekValue=b.width;if(a.seek==c.duration)return b.width="100%",a.seekValue=b.width,!1;setTimeout(function(){B(b)},1E3)},v=function(b){var a,c;a=Math.floor(b/3600);c=Math.floor((b-3600*a)/60);b=Math.floor(b-3600*a-60*c);a=10>a?"0"+a:a;c=10>c?"0"+c:c;b=10>b?"0"+b:b;return 0<a?a+":"+c+":"+b:c+":"+b},C=function(){c.load();setTimeout(function(){c.pause();q.style.width=100*c.currentTime/c.duration+"%"},1150)},r=function(){c.paused?(c.play(),setTimeout(h,500),n.classList.add("pause")):c.pause()},H=function(b,a){"1"==b.style.opacity?(k(b,0),k(a,0),w.style.display="none"):(k(b,1),k(a,1),w.style.display="block")},k=function(b,a){b.style.opacity=a;b.style.zIndex=0===a?"2":"4"},h=function(){I.drawImage(c,(f.offsetWidth-a.dw)/2,(f.offsetHeight-a.dh)/2,a.dw,a.dh);x.innerHTML=v(c.currentTime);a.currentTime=x.innerHTML;q.style.width=100*c.currentTime/c.duration+"%";c.paused||c.ended||setTimeout(h,1E3/a.fps)},u=function(b,e){a.vw=e.videoWidth;a.vh=e.videoHeight;a.vw/a.vh>b.offsetWidth/b.offsetHeight?(a.dw=b.offsetWidth,a.dh=b.offsetWidth*a.vh/a.vw):(a.dh=b.offsetHeight,a.dw=b.offsetHeight*a.vw/a.vh)},d=function(b){return document.getElementById(b)},a={ct:0,fps:30,isFullScreen:!1};(function(b){var a=';<div id="v-tool" class="v-tool-bar">;<div id="v-back" class="v-button back">;<label for="v-back">Back</label>;</div>;<div class="v-title-bar">;<label id="v-title" class="v-title"></label>;</div>;<div id="v-time" class="v-button time"></div>;<div class="v-button tool-menu">;<input type="checkbox" id="v-tool-menu">;<label for="v-tool-menu"></label>;<div class="v-tool-content">;<ul>;<li>Tool1</li>;<li>Tool2</li>;<li>Tool3</li>;</ul>;</div>;</div>;</div>;<div id="v-content" class="v-content">;<div id="v-poster" class="poster"></div>;<div id="v-loading" class="loading"></div>;<div id="v-rotate" class="v-button rotate"></div>;</div>;<div id="v-control" class="v-control-bar">;<div class="v-progress-bar">;<div id="current-time" class="v-current-time"></div>;<div class="v-progress">;<div class="v-progress-back" id="v-progress">;<div class="v-progress-seek">;<label id="v-progress-handle" for="v-progress" class="v-slider progress-handle"></label>;</div>;</div>;</div>;<div id="duration-time" class="v-duration-time"></div>;</div>;<div class="v-control">;<div class="v-control-left"></div>;<div id="v-play" class="v-button play"></div>;<div id="v-stop" class="v-button stop"></div>;<div class="v-control-right">;<div class="v-control-right"></div>;<div class="v-button volume high">;<input type="checkbox" id="v-volume-button">;<label for="v-volume-button"></label>;<div class="v-volume-bar">;<div id="v-volume" class="v-volume">;<label id="v-volume-handle" for="v-volume" class="v-slider volume-handle"></label>;</div>;</div>;</div>;<div id="v-fullscreen" class="v-button fullscreen"></div>;</div>;</div>;</div>'.split(";"),a=a.join("");b.innerHTML+=a})(f.parentNode);var f=document.querySelector("canvas[video]"),I=f.getContext("2d"),c=document.createElement("video"),D=d("v-tool"),J=d("v-content"),E=d("v-control"),K=d("v-back"),l=d("v-title"),L=d("v-time"),w=d("v-rotate"),y=d("v-poster"),F=d("v-loading"),x=d("current-time"),M=d("duration-time"),p=d("v-progress"),q=d("v-progress-handle"),n=d("v-play"),N=d("v-stop"),t=d("v-volume"),G=d("v-volume-handle"),d=d("v-fullscreen");(function(b){a.cow=b.offsetWidth;a.coh=b.offsetHeight;b.width=a.cow;b.height=a.coh;b=b.parentNode;g.android||g.iPhone||g.iPad?b.classList.add("mobile"):b.classList.add("pc");a.rotate="0"})(f);(function(b,e){e.src=b.attributes.src?b.attributes.src.value:[];b.attributes.autoplay&&(e.autoplay=!0,y.style.display="none");e.loop=b.attributes.loop?!0:!1;e.muted=b.attributes.muted?!0:!1;l.innerHTML=b.attributes.title?b.attributes.title.value:[];a.title=l.innerHTML})(f,c);k(D,0);k(E,0);c.addEventListener("loadedmetadata",function(){u(f,c);x.innerHTML=v(c.currentTime);M.innerHTML=v(c.duration);setTimeout(function(){c.paused?n.classList.remove("pause"):n.classList.add("pause");B(q.parentNode.style)},500)},0);c.addEventListener("play",function(){h()},0);c.addEventListener("pause",function(){n.classList.remove("pause")},0);c.addEventListener("ended",function(){c.loop||(a.listNum<a.list.length?a.listNum++:a.listNum=1,l.innerHTML=a.list[a.listNum-1][0],c.src=a.list[a.listNum-1][1],r())},0);c.addEventListener("canplay",function(){F.style.display="none"},0);c.addEventListener("waiting",function(){F.style.display="block"},0);c.addEventListener("volumechange",function(){G.style.height=100*c.volume/1+"%";t.parentNode.parentNode.className=.66<c.volume?"v-button volume high":.33<c.volume?"v-button volume medium":0<c.volume?"v-button volume low":"v-button volume mute"},0);J.addEventListener("click",function(){a.ct++;1==a.ct?(H(D,E),setTimeout(function(){a.ct=0},300)):(r(),a.ct=0)},0);K.addEventListener("click",function(){z(f,c)},0);w.addEventListener("click",function(){var b=f.parentNode.style;0==a.rotate?b.transform="rotate(180deg)":90==a.rotate?(g.gecko&&(a.toX=window.screen.height/2,a.toY=window.screen.height/2,b.transformOrigin=a.toX+"px "+a.toY+"px"),b.transform="rotate(270deg)"):180==a.rotate?b.transform="rotate(0deg)":270==a.rotate&&(g.gecko&&(a.toX=window.screen.width/2,a.toY=window.screen.width/2,b.transformOrigin=a.toX+"px "+a.toY+"px"),b.transform="rotate(90deg)");a.rotate=b.transform.replace(/[^0-9]/ig,"")},0);y.addEventListener("click",function(){r();y.style.display="none"},0);n.addEventListener("click",function(){r()},0);N.addEventListener("click",function(){C()},0);p.addEventListener("click",function(b){var e=p.getBoundingClientRect(),d=q.style,m=document.body;a.pow=p.offsetWidth;0==a.rotate?a.how=b.pageX-e.left-m.scrollLeft:90==a.rotate?a.how=b.pageY-e.top-m.scrollTop:180==a.rotate?(a.how=b.pageX-e.left-m.scrollLeft,a.how=a.pow-a.how):270==a.rotate&&(a.how=b.pageY-e.top-m.scrollTop,a.how=a.pow-a.how);d.width=100*a.how/a.pow+"%";c.currentTime=a.how/a.pow*c.duration;c.paused&&!c.ended&&setTimeout(h,1200)},0);t.addEventListener("click",function(b){var e=t.getBoundingClientRect(),d=G.style,m=document.body;a.voh=t.offsetHeight;a.hoh=b.pageY-e.top-m.scrollTop;b=(a.voh-a.hoh)/a.voh;1<b?(c.volume=1,d.height="100%"):0>b?(c.volume=0,d.height="0%"):(c.volume=b,d.height=100*b+"%");a.volume=b},0);d.addEventListener("click",function(){var b=f,e=c;b.requestFullScreen?b.parentNode.requestFullScreen():b.webkitRequestFullScreen?b.parentNode.webkitRequestFullScreen():b.mozRequestFullScreen&&b.parentNode.parentNode.mozRequestFullScreen();window.screen.width<window.screen.height?(b.parentNode.style.transform="rotate(90deg)",a.rotate="90",b.width=window.screen.height,b.height=window.screen.width,b.parentNode.style.width=window.screen.height+"px",b.parentNode.style.height=window.screen.width+"px",g.gecko&&(a.toX=b.height/2,a.toY=b.height/2,b.parentNode.style.transformOrigin=a.toX+"px "+a.toY+"px")):(b.parentNode.style.width=window.screen.width+"px",b.parentNode.style.height=window.screen.height+"px",b.width=window.screen.width,b.height=window.screen.height);u(b,e);b.parentNode.classList.add("full-screen");a.isFullScreen=!0;h();setTimeout(A,500)},0);(function e(){var a=new Date,c=a.getHours(),d=a.getMinutes(),a=a.getSeconds();L.innerHTML=(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)+":"+(10>a?"0"+a:a);setTimeout(e,1E3)})();(window.CanVideo=function(e){_this=c;l.innerHTML=e?e[0][0]:[];_this.src=e?e[0][1]:[];a.list=e?e:{};a.listNum=e?1:0}).prototype={src:function(a){if(void 0===a)return _this.src;_this.src=a;return!0},title:function(a){if(void 0===a)return l.innerHTML;l.innerHTML=a;return!0},add:function(a){},remove:function(a){},load:function(){_this.load()},play:function(){_this.play()},pause:function(){_this.pause()},stop:function(){C()},autoplay:function(a){_this.autoplay=a},loop:function(a){_this.loop=a},muted:function(a){_this.muted=a},time:function(a,c,d){_this.currentTime=void 0===c&&void 0===d?a:void 0===d?a+60*c:a+60*c+3600*d;return!0},volume:function(c){if("number"==typeof c)return _this.volume=1<c?1:0>c?0:c,a.volume=c,!0;throw{name:"TypeError",message:"volume needs number."};},playRate:function(a){if("number"===typeof a&&0<a)return _this.playbackRate=a,!0;throw{name:"TypeError",message:"playRate needs number."};},version:function(){alert("canVideo version: v0.1.0, Welcome to use.")}}}else return alert("Don't found video sign in Canvas tags, please read help document to use canVideo.js accurately."),!1})();